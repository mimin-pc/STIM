<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Planner Pro - All-in-One</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1; --bg: #f8fafc; --card: #ffffff;
            --text: #1e293b; --danger: #ef4444; --warning: #f59e0b; --success: #10b981;
        }
        .dark-mode {
            --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --primary: #818cf8;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg); color: var(--text);
            margin: 0; padding: 20px; transition: 0.3s;
        }

        .container { max-width: 1000px; margin: 0 auto; }

        /* Header & Progress */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .progress-container { background: #e2e8f0; border-radius: 10px; height: 10px; width: 200px; position: relative; overflow: hidden; }
        #progressBar { background: var(--primary); height: 100%; width: 0%; transition: 0.5s; }

        /* Input & Controls */
        .glass-panel {
            background: var(--card); padding: 20px; border-radius: 20px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); margin-bottom: 25px;
        }
        .input-row { display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px; margin-top: 15px; }
        input, select, .btn { padding: 12px; border-radius: 12px; border: 1px solid #cbd5e1; outline: none; }
        .btn { cursor: pointer; border: none; font-weight: 600; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { transform: scale(1.02); }

        /* Kanban Board */
        .board { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .column { background: rgba(148, 163, 184, 0.1); padding: 15px; border-radius: 20px; min-height: 400px; }
        .column-header { font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }

        /* Task Card */
        .task-card {
            background: var(--card); padding: 15px; border-radius: 15px;
            margin-bottom: 15px; position: relative; border-left: 6px solid #ddd;
            animation: slideIn 0.3s ease; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }
        @keyframes slideIn { from { opacity:0; transform: translateY(10px); } }
        
        .critical-alert { border-color: var(--danger) !important; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }

        .timer { font-family: 'JetBrains Mono'; font-size: 12px; color: var(--primary); font-weight: bold; margin-top: 8px; }
        
        /* Audio Player */
        .audio-widget { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: white; padding: 10px 20px; border-radius: 50px; display: flex; align-items: center; gap: 10px; box-shadow: 0 10px 15px rgba(0,0,0,0.2); }

        .done-text { text-decoration: line-through; opacity: 0.6; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>Study Planner Pro</h1>
            <div style="font-size: 14px; opacity: 0.7;">Progress Selesai: <span id="progressText">0%</span></div>
            <div class="progress-container"><div id="progressBar"></div></div>
        </div>
        <button class="btn" onclick="document.body.classList.toggle('dark-mode')">üåì Mode</button>
    </header>

    <div class="glass-panel">
        <input type="text" id="searchTask" placeholder="üîç Cari tugas..." oninput="renderTasks()" style="width: 100%; box-sizing: border-box;">
        <div class="input-row">
            <input type="text" id="taskName" placeholder="Nama Tugas...">
            <input type="datetime-local" id="taskDate">
            <select id="taskPriority">
                <option value="Tinggi">üî¥ Tinggi</option>
                <option value="Sedang" selected>üü° Sedang</option>
                <option value="Rendah">üü¢ Rendah</option>
            </select>
            <button class="btn btn-primary" onclick="addTask()">Tambah</button>
        </div>
    </div>

    <div class="board">
        <div class="column">
            <div class="column-header">‚è≥ Aktif</div>
            <div id="activeTasks"></div>
        </div>
        <div class="column">
            <div class="column-header">‚úÖ Selesai</div>
            <div id="doneTasks"></div>
        </div>
    </div>
</div>

<div class="audio-widget">
    <span>üéµ Lofi Focus</span>
    <audio id="lofiPlayer" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>
    <button onclick="toggleMusic()" id="playBtn" style="background:none; border:none; color:white; cursor:pointer; font-weight:bold;">PLAY</button>
</div>

<script>
    let tasks = JSON.parse(localStorage.getItem('ultra_tasks')) || [];

    function addTask() {
        const name = document.getElementById('taskName').value;
        const date = document.getElementById('taskDate').value;
        const priority = document.getElementById('taskPriority').value;
        if (!name || !date) return;

        tasks.push({ id: Date.now(), name, deadline: new Date(date).getTime(), priority, completed: false });
        saveAndRender();
        document.getElementById('taskName').value = '';
    }

    function toggleComplete(id) {
        tasks = tasks.map(t => t.id === id ? {...t, completed: !t.completed} : t);
        saveAndRender();
    }

    function deleteTask(id) {
        tasks = tasks.filter(t => t.id !== id);
        saveAndRender();
    }

    function updateStats() {
        const total = tasks.length;
        const done = tasks.filter(t => t.completed).length;
        const percent = total === 0 ? 0 : Math.round((done / total) * 100);
        document.getElementById('progressBar').style.width = percent + '%';
        document.getElementById('progressText').innerText = percent + '%';
    }

    function renderTasks() {
        const activeContainer = document.getElementById('activeTasks');
        const doneContainer = document.getElementById('doneTasks');
        const searchTerm = document.getElementById('searchTask').value.toLowerCase();
        
        activeContainer.innerHTML = '';
        doneContainer.innerHTML = '';

        tasks.filter(t => t.name.toLowerCase().includes(searchTerm))
             .sort((a,b) => a.deadline - b.deadline)
             .forEach(task => {
            const now = new Date().getTime();
            const distance = task.deadline - now;
            const isCritical = distance > 0 && distance < (24 * 60 * 60 * 1000); // < 24 jam

            const card = document.createElement('div');
            card.className = `task-card priority-${task.priority} ${isCritical && !task.completed ? 'critical-alert' : ''}`;
            
            card.innerHTML = `
                <div style="display:flex; justify-content:space-between">
                    <b class="${task.completed ? 'done-text' : ''}">${task.name}</b>
                    <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="toggleComplete(${task.id})">
                </div>
                <div class="timer" id="timer-${task.id}">${task.completed ? 'Selesai' : 'Menghitung...'}</div>
                <button onclick="deleteTask(${task.id})" style="background:none; border:none; color:var(--danger); cursor:pointer; font-size:10px; margin-top:5px; padding:0">Hapus</button>
            `;

            if (task.completed) doneContainer.appendChild(card);
            else activeContainer.appendChild(card);
        });
        updateStats();
    }

    function refreshTimers() {
        tasks.forEach(task => {
            if (task.completed) return;
            const display = document.getElementById(`timer-${task.id}`);
            if (!display) return;
            const distance = task.deadline - new Date().getTime();
            if (distance < 0) { display.innerText = "üö® Waktu Habis!"; display.style.color = 'red'; }
            else {
                const h = Math.floor((distance % (1000*60*60*24)) / (1000*60*60));
                const m = Math.floor((distance % (1000*60*60)) / (1000*60));
                const s = Math.floor((distance % (1000*60)) / 1000);
                display.innerText = `‚è≥ ${Math.floor(distance/(1000*60*60*24))}h ${h}m ${m}s ${s}s`;
            }
        });
    }

    function toggleMusic() {
        const audio = document.getElementById('lofiPlayer');
        const btn = document.getElementById('playBtn');
        if (audio.paused) { audio.play(); btn.innerText = "PAUSE"; }
        else { audio.pause(); btn.innerText = "PLAY"; }
    }

    function saveAndRender() { localStorage.setItem('ultra_tasks', JSON.stringify(tasks)); renderTasks(); }

    setInterval(refreshTimers, 1000);
    renderTasks();
</script>
</body>
</html>
